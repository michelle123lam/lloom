!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("vega-util"),require("vega-canvas"),require("vega-loader"),require("vega-scale")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-canvas","vega-loader","vega-scale"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).vega={},t.vega,t.vega,t.vega,t.vega)}(this,(function(t,i,e,n,s){"use strict";let r=0;const o="p_";function h(t){return t&&t.gradient}function a(t,i,e){const n=t.gradient;let s=t.id,h="radial"===n?o:"";return s||(s=t.id="gradient_"+r++,"radial"===n?(t.x1=l(t.x1,.5),t.y1=l(t.y1,.5),t.r1=l(t.r1,0),t.x2=l(t.x2,.5),t.y2=l(t.y2,.5),t.r2=l(t.r2,.5),h=o):(t.x1=l(t.x1,0),t.y1=l(t.y1,0),t.x2=l(t.x2,1),t.y2=l(t.y2,0))),i[s]=t,"url("+(e||"")+"#"+h+s+")"}function l(t,i){return null!=t?t:i}function c(t){return function(){return t}}const u=Math.abs,_=Math.atan2,f=Math.cos,d=Math.max,p=Math.min,y=Math.sin,x=Math.sqrt,g=1e-12,v=Math.PI,m=v/2,b=2*v;function k(t){return t>=1?m:t<=-1?-m:Math.asin(t)}const w=Math.PI,T=2*w,M=1e-6,R=T-M;function z(t){this._+=t[0];for(let i=1,e=t.length;i<e;++i)this._+=arguments[i]+t[i]}class A{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?z:function(t){let i=Math.floor(t);if(!(i>=0))throw new Error(`invalid digits: ${t}`);if(i>15)return z;const e=10**i;return function(t){this._+=t[0];for(let i=1,n=t.length;i<n;++i)this._+=Math.round(arguments[i]*e)/e+t[i]}}(t)}moveTo(t,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,i){this._append`L${this._x1=+t},${this._y1=+i}`}quadraticCurveTo(t,i,e,n){this._append`Q${+t},${+i},${this._x1=+e},${this._y1=+n}`}bezierCurveTo(t,i,e,n,s,r){this._append`C${+t},${+i},${+e},${+n},${this._x1=+s},${this._y1=+r}`}arcTo(t,i,e,n,s){if(t=+t,i=+i,e=+e,n=+n,(s=+s)<0)throw new Error(`negative radius: ${s}`);let r=this._x1,o=this._y1,h=e-t,a=n-i,l=r-t,c=o-i,u=l*l+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=i}`;else if(u>M)if(Math.abs(c*h-a*l)>M&&s){let _=e-r,f=n-o,d=h*h+a*a,p=_*_+f*f,y=Math.sqrt(d),x=Math.sqrt(u),g=s*Math.tan((w-Math.acos((d+u-p)/(2*y*x)))/2),v=g/x,m=g/y;Math.abs(v-1)>M&&this._append`L${t+v*l},${i+v*c}`,this._append`A${s},${s},0,0,${+(c*_>l*f)},${this._x1=t+m*h},${this._y1=i+m*a}`}else this._append`L${this._x1=t},${this._y1=i}`;else;}arc(t,i,e,n,s,r){if(t=+t,i=+i,r=!!r,(e=+e)<0)throw new Error(`negative radius: ${e}`);let o=e*Math.cos(n),h=e*Math.sin(n),a=t+o,l=i+h,c=1^r,u=r?n-s:s-n;null===this._x1?this._append`M${a},${l}`:(Math.abs(this._x1-a)>M||Math.abs(this._y1-l)>M)&&this._append`L${a},${l}`,e&&(u<0&&(u=u%T+T),u>R?this._append`A${e},${e},0,1,${c},${t-o},${i-h}A${e},${e},0,1,${c},${this._x1=a},${this._y1=l}`:u>M&&this._append`A${e},${e},0,${+(u>=w)},${c},${this._x1=t+e*Math.cos(s)},${this._y1=i+e*Math.sin(s)}`)}rect(t,i,e,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${e=+e}v${+n}h${-e}Z`}toString(){return this._}}function S(){return new A}function N(t){let i=3;return t.digits=function(e){if(!arguments.length)return i;if(null==e)i=null;else{const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);i=t}return t},()=>new A(i)}function C(t){return t.innerRadius}function E(t){return t.outerRadius}function $(t){return t.startAngle}function P(t){return t.endAngle}function L(t){return t&&t.padAngle}function O(t,i,e,n,s,r,o){var h=t-e,a=i-n,l=(o?r:-r)/x(h*h+a*a),c=l*a,u=-l*h,_=t+c,f=i+u,p=e+c,y=n+u,g=(_+p)/2,v=(f+y)/2,m=p-_,b=y-f,k=m*m+b*b,w=s-r,T=_*y-p*f,M=(b<0?-1:1)*x(d(0,w*w*k-T*T)),R=(T*b-m*M)/k,z=(-T*m-b*M)/k,A=(T*b+m*M)/k,S=(-T*m+b*M)/k,N=R-g,C=z-v,E=A-g,$=S-v;return N*N+C*C>E*E+$*$&&(R=A,z=S),{cx:R,cy:z,x01:-c,y01:-u,x11:R*(s/w-1),y11:z*(s/w-1)}}function q(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function I(t){this._context=t}function D(t){return new I(t)}function V(t){return t[0]}function H(t){return t[1]}function j(t,i){var e=c(!0),n=null,s=D,r=null,o=N(h);function h(h){var a,l,c,u=(h=q(h)).length,_=!1;for(null==n&&(r=s(c=o())),a=0;a<=u;++a)!(a<u&&e(l=h[a],a,h))===_&&((_=!_)?r.lineStart():r.lineEnd()),_&&r.point(+t(l,a,h),+i(l,a,h));if(c)return r=null,c+""||null}return t="function"==typeof t?t:void 0===t?V:c(t),i="function"==typeof i?i:void 0===i?H:c(i),h.x=function(i){return arguments.length?(t="function"==typeof i?i:c(+i),h):t},h.y=function(t){return arguments.length?(i="function"==typeof t?t:c(+t),h):i},h.defined=function(t){return arguments.length?(e="function"==typeof t?t:c(!!t),h):e},h.curve=function(t){return arguments.length?(s=t,null!=n&&(r=s(n)),h):s},h.context=function(t){return arguments.length?(null==t?n=r=null:r=s(n=t),h):n},h}function B(t,i,e){var n=null,s=c(!0),r=null,o=D,h=null,a=N(l);function l(l){var c,u,_,f,d,p=(l=q(l)).length,y=!1,x=new Array(p),g=new Array(p);for(null==r&&(h=o(d=a())),c=0;c<=p;++c){if(!(c<p&&s(f=l[c],c,l))===y)if(y=!y)u=c,h.areaStart(),h.lineStart();else{for(h.lineEnd(),h.lineStart(),_=c-1;_>=u;--_)h.point(x[_],g[_]);h.lineEnd(),h.areaEnd()}y&&(x[c]=+t(f,c,l),g[c]=+i(f,c,l),h.point(n?+n(f,c,l):x[c],e?+e(f,c,l):g[c]))}if(d)return h=null,d+""||null}function u(){return j().defined(s).curve(o).context(r)}return t="function"==typeof t?t:void 0===t?V:c(+t),i="function"==typeof i?i:c(void 0===i?0:+i),e="function"==typeof e?e:void 0===e?H:c(+e),l.x=function(i){return arguments.length?(t="function"==typeof i?i:c(+i),n=null,l):t},l.x0=function(i){return arguments.length?(t="function"==typeof i?i:c(+i),l):t},l.x1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:c(+t),l):n},l.y=function(t){return arguments.length?(i="function"==typeof t?t:c(+t),e=null,l):i},l.y0=function(t){return arguments.length?(i="function"==typeof t?t:c(+t),l):i},l.y1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:c(+t),l):e},l.lineX0=l.lineY0=function(){return u().x(t).y(i)},l.lineY1=function(){return u().x(t).y(e)},l.lineX1=function(){return u().x(n).y(i)},l.defined=function(t){return arguments.length?(s="function"==typeof t?t:c(!!t),l):s},l.curve=function(t){return arguments.length?(o=t,null!=r&&(h=o(r)),l):o},l.context=function(t){return arguments.length?(null==t?r=h=null:h=o(r=t),l):r},l}S.prototype=A.prototype,I.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:this._context.lineTo(t,i)}}};var G={draw(t,i){const e=x(i/v);t.moveTo(e,0),t.arc(0,0,e,0,b)}};function W(){}function X(t,i,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+i)/6,(t._y0+4*t._y1+e)/6)}function U(t){this._context=t}function F(t){this._context=t}function Y(t){this._context=t}function J(t,i){this._basis=new U(t),this._beta=i}U.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:X(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:X(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},F.prototype={areaStart:W,areaEnd:W,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._x2=t,this._y2=i;break;case 1:this._point=2,this._x3=t,this._y3=i;break;case 2:this._point=3,this._x4=t,this._y4=i,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+i)/6);break;default:X(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},Y.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var e=(this._x0+4*this._x1+t)/6,n=(this._y0+4*this._y1+i)/6;this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 3:this._point=4;default:X(this,t,i)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i}},J.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,i=this._y,e=t.length-1;if(e>0)for(var n,s=t[0],r=i[0],o=t[e]-s,h=i[e]-r,a=-1;++a<=e;)n=a/e,this._basis.point(this._beta*t[a]+(1-this._beta)*(s+n*o),this._beta*i[a]+(1-this._beta)*(r+n*h));this._x=this._y=null,this._basis.lineEnd()},point:function(t,i){this._x.push(+t),this._y.push(+i)}};var Z=function t(i){function e(t){return 1===i?new U(t):new J(t,i)}return e.beta=function(i){return t(+i)},e}(.85);function Q(t,i,e){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-i),t._y2+t._k*(t._y1-e),t._x2,t._y2)}function K(t,i){this._context=t,this._k=(1-i)/6}K.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Q(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2,this._x1=t,this._y1=i;break;case 2:this._point=3;default:Q(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var tt=function t(i){function e(t){return new K(t,i)}return e.tension=function(i){return t(+i)},e}(0);function it(t,i){this._context=t,this._k=(1-i)/6}it.prototype={areaStart:W,areaEnd:W,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._x3=t,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=i);break;case 2:this._point=3,this._x5=t,this._y5=i;break;default:Q(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var et=function t(i){function e(t){return new it(t,i)}return e.tension=function(i){return t(+i)},e}(0);function nt(t,i){this._context=t,this._k=(1-i)/6}nt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Q(this,t,i)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var st=function t(i){function e(t){return new nt(t,i)}return e.tension=function(i){return t(+i)},e}(0);function rt(t,i,e){var n=t._x1,s=t._y1,r=t._x2,o=t._y2;if(t._l01_a>g){var h=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,a=3*t._l01_a*(t._l01_a+t._l12_a);n=(n*h-t._x0*t._l12_2a+t._x2*t._l01_2a)/a,s=(s*h-t._y0*t._l12_2a+t._y2*t._l01_2a)/a}if(t._l23_a>g){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);r=(r*l+t._x1*t._l23_2a-i*t._l12_2a)/c,o=(o*l+t._y1*t._l23_2a-e*t._l12_2a)/c}t._context.bezierCurveTo(n,s,r,o,t._x2,t._y2)}function ot(t,i){this._context=t,this._alpha=i}ot.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){if(t=+t,i=+i,this._point){var e=this._x2-t,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3;default:rt(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var ht=function t(i){function e(t){return i?new ot(t,i):new K(t,0)}return e.alpha=function(i){return t(+i)},e}(.5);function at(t,i){this._context=t,this._alpha=i}at.prototype={areaStart:W,areaEnd:W,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,i){if(t=+t,i=+i,this._point){var e=this._x2-t,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=i);break;case 2:this._point=3,this._x5=t,this._y5=i;break;default:rt(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var lt=function t(i){function e(t){return i?new at(t,i):new it(t,0)}return e.alpha=function(i){return t(+i)},e}(.5);function ct(t,i){this._context=t,this._alpha=i}ct.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){if(t=+t,i=+i,this._point){var e=this._x2-t,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:rt(this,t,i)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i}};var ut=function t(i){function e(t){return i?new ct(t,i):new nt(t,0)}return e.alpha=function(i){return t(+i)},e}(.5);function _t(t){this._context=t}function ft(t){return t<0?-1:1}function dt(t,i,e){var n=t._x1-t._x0,s=i-t._x1,r=(t._y1-t._y0)/(n||s<0&&-0),o=(e-t._y1)/(s||n<0&&-0),h=(r*s+o*n)/(n+s);return(ft(r)+ft(o))*Math.min(Math.abs(r),Math.abs(o),.5*Math.abs(h))||0}function pt(t,i){var e=t._x1-t._x0;return e?(3*(t._y1-t._y0)/e-i)/2:i}function yt(t,i,e){var n=t._x0,s=t._y0,r=t._x1,o=t._y1,h=(r-n)/3;t._context.bezierCurveTo(n+h,s+h*i,r-h,o-h*e,r,o)}function xt(t){this._context=t}function gt(t){this._context=new vt(t)}function vt(t){this._context=t}function mt(t){this._context=t}function bt(t){var i,e,n=t.length-1,s=new Array(n),r=new Array(n),o=new Array(n);for(s[0]=0,r[0]=2,o[0]=t[0]+2*t[1],i=1;i<n-1;++i)s[i]=1,r[i]=4,o[i]=4*t[i]+2*t[i+1];for(s[n-1]=2,r[n-1]=7,o[n-1]=8*t[n-1]+t[n],i=1;i<n;++i)e=s[i]/r[i-1],r[i]-=e,o[i]-=e*o[i-1];for(s[n-1]=o[n-1]/r[n-1],i=n-2;i>=0;--i)s[i]=(o[i]-s[i+1])/r[i];for(r[n-1]=(t[n]+s[n-1])/2,i=0;i<n-1;++i)r[i]=2*t[i+1]-s[i+1];return[s,r]}function kt(t,i){this._context=t,this._t=i}_t.prototype={areaStart:W,areaEnd:W,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,i){t=+t,i=+i,this._point?this._context.lineTo(t,i):(this._point=1,this._context.moveTo(t,i))}},xt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:yt(this,this._t0,pt(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){var e=NaN;if(i=+i,(t=+t)!==this._x1||i!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3,yt(this,pt(this,e=dt(this,t,i)),e);break;default:yt(this,this._t0,e=dt(this,t,i))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i,this._t0=e}}},(gt.prototype=Object.create(xt.prototype)).point=function(t,i){xt.prototype.point.call(this,i,t)},vt.prototype={moveTo:function(t,i){this._context.moveTo(i,t)},closePath:function(){this._context.closePath()},lineTo:function(t,i){this._context.lineTo(i,t)},bezierCurveTo:function(t,i,e,n,s,r){this._context.bezierCurveTo(i,t,n,e,r,s)}},mt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,i=this._y,e=t.length;if(e)if(this._line?this._context.lineTo(t[0],i[0]):this._context.moveTo(t[0],i[0]),2===e)this._context.lineTo(t[1],i[1]);else for(var n=bt(t),s=bt(i),r=0,o=1;o<e;++r,++o)this._context.bezierCurveTo(n[0][r],s[0][r],n[1][r],s[1][r],t[o],i[o]);(this._line||0!==this._line&&1===e)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,i){this._x.push(+t),this._y.push(+i)}},kt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,i),this._context.lineTo(t,i);else{var e=this._x*(1-this._t)+t*this._t;this._context.lineTo(e,this._y),this._context.lineTo(e,i)}}this._x=t,this._y=i}};const wt={basis:{curve:function(t){return new U(t)}},"basis-closed":{curve:function(t){return new F(t)}},"basis-open":{curve:function(t){return new Y(t)}},bundle:{curve:Z,tension:"beta",value:.85},cardinal:{curve:tt,tension:"tension",value:0},"cardinal-open":{curve:st,tension:"tension",value:0},"cardinal-closed":{curve:et,tension:"tension",value:0},"catmull-rom":{curve:ht,tension:"alpha",value:.5},"catmull-rom-closed":{curve:lt,tension:"alpha",value:.5},"catmull-rom-open":{curve:ut,tension:"alpha",value:.5},linear:{curve:D},"linear-closed":{curve:function(t){return new _t(t)}},monotone:{horizontal:function(t){return new gt(t)},vertical:function(t){return new xt(t)}},natural:{curve:function(t){return new mt(t)}},step:{curve:function(t){return new kt(t,.5)}},"step-after":{curve:function(t){return new kt(t,1)}},"step-before":{curve:function(t){return new kt(t,0)}}};function Tt(t,e,n){var s=i.hasOwnProperty(wt,t)&&wt[t],r=null;return s&&(r=s.curve||s[e||"vertical"],s.tension&&null!=n&&(r=r[s.tension](n))),r}const Mt={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},Rt=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,zt=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,At=/^((\s+,?\s*)|(,\s*))/,St=/^[01]/;function Nt(t){const i=[];return(t.match(Rt)||[]).forEach((t=>{let e=t[0];const n=e.toLowerCase(),s=Mt[n],r=function(t,i,e){const n=[];for(let s=0;i&&s<e.length;)for(let r=0;r<i;++r){const i="a"!==t||3!==r&&4!==r?zt:St,o=e.slice(s).match(i);if(null===o)throw Error("Invalid SVG path, incorrect parameter type");s+=o[0].length,n.push(+o[0]);const h=e.slice(s).match(At);null!==h&&(s+=h[0].length)}return n}(n,s,t.slice(1).trim()),o=r.length;if(o<s||o&&o%s!=0)throw Error("Invalid SVG path, incorrect parameter count");if(i.push([e,...r.slice(0,s)]),o!==s){"m"===n&&(e="M"===e?"L":"l");for(let t=s;t<o;t+=s)i.push([e,...r.slice(t,t+s)])}})),i}const Ct=Math.PI/180,Et=Math.PI/2,$t=2*Math.PI,Pt=Math.sqrt(3)/2;var Lt={},Ot={},qt=[].join;function It(t){const i=qt.call(t);if(Ot[i])return Ot[i];var e=t[0],n=t[1],s=t[2],r=t[3],o=t[4],h=t[5],a=t[6],l=t[7];const c=l*o,u=-a*h,_=a*o,f=l*h,d=Math.cos(s),p=Math.sin(s),y=Math.cos(r),x=Math.sin(r),g=.5*(r-s),v=Math.sin(.5*g),m=8/3*v*v/Math.sin(g),b=e+d-m*p,k=n+p+m*d,w=e+y,T=n+x,M=w+m*x,R=T-m*y;return Ot[i]=[c*b+u*k,_*b+f*k,c*M+u*R,_*M+f*R,c*w+u*T,_*w+f*T]}const Dt=["l",0,0,0,0,0,0,0];function Vt(t,i,e){const n=Dt[0]=t[0];if("a"===n||"A"===n)Dt[1]=i*t[1],Dt[2]=e*t[2],Dt[3]=t[3],Dt[4]=t[4],Dt[5]=t[5],Dt[6]=i*t[6],Dt[7]=e*t[7];else if("h"===n||"H"===n)Dt[1]=i*t[1];else if("v"===n||"V"===n)Dt[1]=e*t[1];else for(var s=1,r=t.length;s<r;++s)Dt[s]=(s%2==1?i:e)*t[s];return Dt}function Ht(t,i,e,n,s,r){var o,h,a,l,c,u=null,_=0,f=0,d=0,p=0,y=0,x=0;null==e&&(e=0),null==n&&(n=0),null==s&&(s=1),null==r&&(r=s),t.beginPath&&t.beginPath();for(var g=0,v=i.length;g<v;++g){switch(o=i[g],1===s&&1===r||(o=Vt(o,s,r)),o[0]){case"l":_+=o[1],f+=o[2],t.lineTo(_+e,f+n);break;case"L":_=o[1],f=o[2],t.lineTo(_+e,f+n);break;case"h":_+=o[1],t.lineTo(_+e,f+n);break;case"H":_=o[1],t.lineTo(_+e,f+n);break;case"v":f+=o[1],t.lineTo(_+e,f+n);break;case"V":f=o[1],t.lineTo(_+e,f+n);break;case"m":y=_+=o[1],x=f+=o[2],t.moveTo(_+e,f+n);break;case"M":y=_=o[1],x=f=o[2],t.moveTo(_+e,f+n);break;case"c":h=_+o[5],a=f+o[6],d=_+o[3],p=f+o[4],t.bezierCurveTo(_+o[1]+e,f+o[2]+n,d+e,p+n,h+e,a+n),_=h,f=a;break;case"C":_=o[5],f=o[6],d=o[3],p=o[4],t.bezierCurveTo(o[1]+e,o[2]+n,d+e,p+n,_+e,f+n);break;case"s":h=_+o[3],a=f+o[4],d=2*_-d,p=2*f-p,t.bezierCurveTo(d+e,p+n,_+o[1]+e,f+o[2]+n,h+e,a+n),d=_+o[1],p=f+o[2],_=h,f=a;break;case"S":h=o[3],a=o[4],d=2*_-d,p=2*f-p,t.bezierCurveTo(d+e,p+n,o[1]+e,o[2]+n,h+e,a+n),_=h,f=a,d=o[1],p=o[2];break;case"q":h=_+o[3],a=f+o[4],d=_+o[1],p=f+o[2],t.quadraticCurveTo(d+e,p+n,h+e,a+n),_=h,f=a;break;case"Q":h=o[3],a=o[4],t.quadraticCurveTo(o[1]+e,o[2]+n,h+e,a+n),_=h,f=a,d=o[1],p=o[2];break;case"t":h=_+o[1],a=f+o[2],null===u[0].match(/[QqTt]/)?(d=_,p=f):"t"===u[0]?(d=2*_-l,p=2*f-c):"q"===u[0]&&(d=2*_-d,p=2*f-p),l=d,c=p,t.quadraticCurveTo(d+e,p+n,h+e,a+n),f=a,d=(_=h)+o[1],p=f+o[2];break;case"T":h=o[1],a=o[2],d=2*_-d,p=2*f-p,t.quadraticCurveTo(d+e,p+n,h+e,a+n),_=h,f=a;break;case"a":jt(t,_+e,f+n,[o[1],o[2],o[3],o[4],o[5],o[6]+_+e,o[7]+f+n]),_+=o[6],f+=o[7];break;case"A":jt(t,_+e,f+n,[o[1],o[2],o[3],o[4],o[5],o[6]+e,o[7]+n]),_=o[6],f=o[7];break;case"z":case"Z":_=y,f=x,t.closePath()}u=o}}function jt(t,i,e,n){const s=function(t,i,e,n,s,r,o,h,a){const l=qt.call(arguments);if(Lt[l])return Lt[l];const c=o*Ct,u=Math.sin(c),_=Math.cos(c),f=_*(h-t)*.5+u*(a-i)*.5,d=_*(a-i)*.5-u*(h-t)*.5;let p=f*f/((e=Math.abs(e))*e)+d*d/((n=Math.abs(n))*n);p>1&&(p=Math.sqrt(p),e*=p,n*=p);const y=_/e,x=u/e,g=-u/n,v=_/n,m=y*h+x*a,b=g*h+v*a,k=y*t+x*i,w=g*t+v*i;let T=1/((k-m)*(k-m)+(w-b)*(w-b))-.25;T<0&&(T=0);let M=Math.sqrt(T);r==s&&(M=-M);const R=.5*(m+k)-M*(w-b),z=.5*(b+w)+M*(k-m),A=Math.atan2(b-z,m-R);let S=Math.atan2(w-z,k-R)-A;S<0&&1===r?S+=$t:S>0&&0===r&&(S-=$t);const N=Math.ceil(Math.abs(S/(Et+.001))),C=[];for(let t=0;t<N;++t){const i=A+t*S/N,s=A+(t+1)*S/N;C[t]=[R,z,i,s,e,n,u,_]}return Lt[l]=C}(n[5],n[6],n[0],n[1],n[3],n[4],n[2],i,e);for(let i=0;i<s.length;++i){const e=It(s[i]);t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])}}const Bt=.5773502691896257,Gt={circle:{draw:function(t,i){const e=Math.sqrt(i)/2;t.moveTo(e,0),t.arc(0,0,e,0,$t)}},cross:{draw:function(t,i){var e=Math.sqrt(i)/2,n=e/2.5;t.moveTo(-e,-n),t.lineTo(-e,n),t.lineTo(-n,n),t.lineTo(-n,e),t.lineTo(n,e),t.lineTo(n,n),t.lineTo(e,n),t.lineTo(e,-n),t.lineTo(n,-n),t.lineTo(n,-e),t.lineTo(-n,-e),t.lineTo(-n,-n),t.closePath()}},diamond:{draw:function(t,i){const e=Math.sqrt(i)/2;t.moveTo(-e,0),t.lineTo(0,-e),t.lineTo(e,0),t.lineTo(0,e),t.closePath()}},square:{draw:function(t,i){var e=Math.sqrt(i),n=-e/2;t.rect(n,n,e,e)}},arrow:{draw:function(t,i){var e=Math.sqrt(i)/2,n=e/7,s=e/2.5,r=e/8;t.moveTo(-n,e),t.lineTo(n,e),t.lineTo(n,-r),t.lineTo(s,-r),t.lineTo(0,-e),t.lineTo(-s,-r),t.lineTo(-n,-r),t.closePath()}},wedge:{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e,s=n-e*Bt,r=e/4;t.moveTo(0,-n-s),t.lineTo(-r,n-s),t.lineTo(r,n-s),t.closePath()}},triangle:{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e,s=n-e*Bt;t.moveTo(0,-n-s),t.lineTo(-e,n-s),t.lineTo(e,n-s),t.closePath()}},"triangle-up":{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e;t.moveTo(0,-n),t.lineTo(-e,n),t.lineTo(e,n),t.closePath()}},"triangle-down":{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e;t.moveTo(0,n),t.lineTo(-e,-n),t.lineTo(e,-n),t.closePath()}},"triangle-right":{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e;t.moveTo(n,0),t.lineTo(-n,-e),t.lineTo(-n,e),t.closePath()}},"triangle-left":{draw:function(t,i){var e=Math.sqrt(i)/2,n=Pt*e;t.moveTo(-n,0),t.lineTo(n,-e),t.lineTo(n,e),t.closePath()}},stroke:{draw:function(t,i){const e=Math.sqrt(i)/2;t.moveTo(-e,0),t.lineTo(e,0)}}};function Wt(t){return i.hasOwnProperty(Gt,t)?Gt[t]:function(t){if(!i.hasOwnProperty(Xt,t)){const i=Nt(t);Xt[t]={draw:function(t,e){Ht(t,i,0,0,Math.sqrt(e)/2)}}}return Xt[t]}(t)}var Xt={};const Ut=.448084975506;function Ft(t){return t.x}function Yt(t){return t.y}function Jt(t){return t.width}function Zt(t){return t.height}function Qt(t){return"function"==typeof t?t:()=>+t}function Kt(t,i,e){return Math.max(i,Math.min(t,e))}function ti(){var t=Ft,i=Yt,e=Jt,n=Zt,s=Qt(0),r=s,o=s,h=s,a=null;function l(l,c,u){var _,f=null!=c?c:+t.call(this,l),d=null!=u?u:+i.call(this,l),p=+e.call(this,l),y=+n.call(this,l),x=Math.min(p,y)/2,g=Kt(+s.call(this,l),0,x),v=Kt(+r.call(this,l),0,x),m=Kt(+o.call(this,l),0,x),b=Kt(+h.call(this,l),0,x);if(a||(a=_=S()),g<=0&&v<=0&&m<=0&&b<=0)a.rect(f,d,p,y);else{var k=f+p,w=d+y;a.moveTo(f+g,d),a.lineTo(k-v,d),a.bezierCurveTo(k-Ut*v,d,k,d+Ut*v,k,d+v),a.lineTo(k,w-b),a.bezierCurveTo(k,w-Ut*b,k-Ut*b,w,k-b,w),a.lineTo(f+m,w),a.bezierCurveTo(f+Ut*m,w,f,w-Ut*m,f,w-m),a.lineTo(f,d+g),a.bezierCurveTo(f,d+Ut*g,f+Ut*g,d,f+g,d),a.closePath()}if(_)return a=null,_+""||null}return l.x=function(i){return arguments.length?(t=Qt(i),l):t},l.y=function(t){return arguments.length?(i=Qt(t),l):i},l.width=function(t){return arguments.length?(e=Qt(t),l):e},l.height=function(t){return arguments.length?(n=Qt(t),l):n},l.cornerRadius=function(t,i,e,n){return arguments.length?(s=Qt(t),r=null!=i?Qt(i):s,h=null!=e?Qt(e):s,o=null!=n?Qt(n):r,l):s},l.context=function(t){return arguments.length?(a=null==t?null:t,l):a},l}function ii(){var t,i,e,n,s,r,o,h,a=null;function l(t,i,e){const n=e/2;if(s){var l=o-i,c=t-r;if(l||c){var u=Math.hypot(l,c),_=(l/=u)*h,f=(c/=u)*h,d=Math.atan2(c,l);a.moveTo(r-_,o-f),a.lineTo(t-l*n,i-c*n),a.arc(t,i,n,d-Math.PI,d),a.lineTo(r+_,o+f),a.arc(r,o,h,d,d+Math.PI)}else a.arc(t,i,n,0,$t);a.closePath()}else s=1;r=t,o=i,h=n}function c(r){var o,h,c,u=r.length,_=!1;for(null==a&&(a=c=S()),o=0;o<=u;++o)!(o<u&&n(h=r[o],o,r))===_&&(_=!_)&&(s=0),_&&l(+t(h,o,r),+i(h,o,r),+e(h,o,r));if(c)return a=null,c+""||null}return c.x=function(i){return arguments.length?(t=i,c):t},c.y=function(t){return arguments.length?(i=t,c):i},c.size=function(t){return arguments.length?(e=t,c):e},c.defined=function(t){return arguments.length?(n=t,c):n},c.context=function(t){return arguments.length?(a=null==t?null:t,c):a},c}function ei(t,i){return null!=t?t:i}const ni=t=>t.x||0,si=t=>t.y||0,ri=t=>!(!1===t.defined),oi=function(){var t=C,i=E,e=c(0),n=null,s=$,r=P,o=L,h=null,a=N(l);function l(){var l,c,d=+t.apply(this,arguments),w=+i.apply(this,arguments),T=s.apply(this,arguments)-m,M=r.apply(this,arguments)-m,R=u(M-T),z=M>T;if(h||(h=l=a()),w<d&&(c=w,w=d,d=c),w>g)if(R>b-g)h.moveTo(w*f(T),w*y(T)),h.arc(0,0,w,T,M,!z),d>g&&(h.moveTo(d*f(M),d*y(M)),h.arc(0,0,d,M,T,z));else{var A,S,N=T,C=M,E=T,$=M,P=R,L=R,q=o.apply(this,arguments)/2,I=q>g&&(n?+n.apply(this,arguments):x(d*d+w*w)),D=p(u(w-d)/2,+e.apply(this,arguments)),V=D,H=D;if(I>g){var j=k(I/d*y(q)),B=k(I/w*y(q));(P-=2*j)>g?(E+=j*=z?1:-1,$-=j):(P=0,E=$=(T+M)/2),(L-=2*B)>g?(N+=B*=z?1:-1,C-=B):(L=0,N=C=(T+M)/2)}var G=w*f(N),W=w*y(N),X=d*f($),U=d*y($);if(D>g){var F,Y=w*f(C),J=w*y(C),Z=d*f(E),Q=d*y(E);if(R<v)if(F=function(t,i,e,n,s,r,o,h){var a=e-t,l=n-i,c=o-s,u=h-r,_=u*a-c*l;if(!(_*_<g))return[t+(_=(c*(i-r)-u*(t-s))/_)*a,i+_*l]}(G,W,Z,Q,Y,J,X,U)){var K=G-F[0],tt=W-F[1],it=Y-F[0],et=J-F[1],nt=1/y(function(t){return t>1?0:t<-1?v:Math.acos(t)}((K*it+tt*et)/(x(K*K+tt*tt)*x(it*it+et*et)))/2),st=x(F[0]*F[0]+F[1]*F[1]);V=p(D,(d-st)/(nt-1)),H=p(D,(w-st)/(nt+1))}else V=H=0}L>g?H>g?(A=O(Z,Q,G,W,w,H,z),S=O(Y,J,X,U,w,H,z),h.moveTo(A.cx+A.x01,A.cy+A.y01),H<D?h.arc(A.cx,A.cy,H,_(A.y01,A.x01),_(S.y01,S.x01),!z):(h.arc(A.cx,A.cy,H,_(A.y01,A.x01),_(A.y11,A.x11),!z),h.arc(0,0,w,_(A.cy+A.y11,A.cx+A.x11),_(S.cy+S.y11,S.cx+S.x11),!z),h.arc(S.cx,S.cy,H,_(S.y11,S.x11),_(S.y01,S.x01),!z))):(h.moveTo(G,W),h.arc(0,0,w,N,C,!z)):h.moveTo(G,W),d>g&&P>g?V>g?(A=O(X,U,Y,J,d,-V,z),S=O(G,W,Z,Q,d,-V,z),h.lineTo(A.cx+A.x01,A.cy+A.y01),V<D?h.arc(A.cx,A.cy,V,_(A.y01,A.x01),_(S.y01,S.x01),!z):(h.arc(A.cx,A.cy,V,_(A.y01,A.x01),_(A.y11,A.x11),!z),h.arc(0,0,d,_(A.cy+A.y11,A.cx+A.x11),_(S.cy+S.y11,S.cx+S.x11),z),h.arc(S.cx,S.cy,V,_(S.y11,S.x11),_(S.y01,S.x01),!z))):h.arc(0,0,d,$,E,z):h.lineTo(X,U)}else h.moveTo(0,0);if(h.closePath(),l)return h=null,l+""||null}return l.centroid=function(){var e=(+t.apply(this,arguments)+ +i.apply(this,arguments))/2,n=(+s.apply(this,arguments)+ +r.apply(this,arguments))/2-v/2;return[f(n)*e,y(n)*e]},l.innerRadius=function(i){return arguments.length?(t="function"==typeof i?i:c(+i),l):t},l.outerRadius=function(t){return arguments.length?(i="function"==typeof t?t:c(+t),l):i},l.cornerRadius=function(t){return arguments.length?(e="function"==typeof t?t:c(+t),l):e},l.padRadius=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:c(+t),l):n},l.startAngle=function(t){return arguments.length?(s="function"==typeof t?t:c(+t),l):s},l.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:c(+t),l):r},l.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:c(+t),l):o},l.context=function(t){return arguments.length?(h=null==t?null:t,l):h},l}().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),hi=B().x(ni).y1(si).y0((t=>(t.y||0)+(t.height||0))).defined(ri),ai=B().y(si).x1(ni).x0((t=>(t.x||0)+(t.width||0))).defined(ri),li=j().x(ni).y(si).defined(ri),ci=ti().x(ni).y(si).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>ei(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>ei(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>ei(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>ei(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),ui=function(t,i){let e=null,n=N(s);function s(){let s;if(e||(e=s=n()),t.apply(this,arguments).draw(e,+i.apply(this,arguments)),s)return e=null,s+""||null}return t="function"==typeof t?t:c(t||G),i="function"==typeof i?i:c(void 0===i?64:+i),s.type=function(i){return arguments.length?(t="function"==typeof i?i:c(i),s):t},s.size=function(t){return arguments.length?(i="function"==typeof t?t:c(+t),s):i},s.context=function(t){return arguments.length?(e=null==t?null:t,s):e},s}().type((t=>Wt(t.shape||"circle"))).size((t=>ei(t.size,64))),_i=ii().x(ni).y(si).defined(ri).size((t=>t.size||1));function fi(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function di(t,i,e,n){return ci.context(t)(i,e,n)}var pi=1;function yi(){pi=1}function xi(t,e,n){var s=e.clip,r=t._defs,o=e.clip_id||(e.clip_id="clip"+pi++),h=r.clipping[o]||(r.clipping[o]={id:o});return i.isFunction(s)?h.path=s(null):fi(n)?h.path=di(null,n,0,0):(h.width=n.width||0,h.height=n.height||0),"url(#"+o+")"}function gi(t){this.clear(),t&&this.union(t)}function vi(t){this.mark=t,this.bounds=this.bounds||new gi}function mi(t){vi.call(this,t),this.items=this.items||[]}function bi(t){this._pending=0,this._loader=t||n.loader()}function ki(t){t._pending+=1}function wi(t){t._pending-=1}function Ti(t,i,e){if(i.stroke&&0!==i.opacity&&0!==i.strokeOpacity){const n=null!=i.strokeWidth?+i.strokeWidth:1;t.expand(n+(e?function(t,i){return t.strokeJoin&&"miter"!==t.strokeJoin?0:i}(i,n):0))}return t}gi.prototype={clone(){return new gi(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,i,e,n){return e<t?(this.x2=t,this.x1=e):(this.x1=t,this.x2=e),n<i?(this.y2=i,this.y1=n):(this.y1=i,this.y2=n),this},add(t,i){return t<this.x1&&(this.x1=t),i<this.y1&&(this.y1=i),t>this.x2&&(this.x2=t),i>this.y2&&(this.y2=i),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,i){return this.x1+=t,this.x2+=t,this.y1+=i,this.y2+=i,this},rotate(t,i,e){const n=this.rotatedPoints(t,i,e);return this.clear().add(n[0],n[1]).add(n[2],n[3]).add(n[4],n[5]).add(n[6],n[7])},rotatedPoints(t,i,e){var{x1:n,y1:s,x2:r,y2:o}=this,h=Math.cos(t),a=Math.sin(t),l=i-i*h+e*a,c=e-i*a-e*h;return[h*n-a*s+l,a*n+h*s+c,h*n-a*o+l,a*n+h*o+c,h*r-a*s+l,a*r+h*s+c,h*r-a*o+l,a*r+h*o+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,i){return!(t<this.x1||t>this.x2||i<this.y1||i>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},i.inherits(mi,vi),bi.prototype={pending(){return this._pending},sanitizeURL(t){const i=this;return ki(i),i._loader.sanitize(t,{context:"href"}).then((t=>(wi(i),t))).catch((()=>(wi(i),null)))},loadImage(t){const n=this,s=e.image();return ki(n),n._loader.sanitize(t,{context:"image"}).then((t=>{const e=t.href;if(!e||!s)throw{url:e};const r=new s,o=i.hasOwnProperty(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=o&&(r.crossOrigin=o),r.onload=()=>wi(n),r.onerror=()=>wi(n),r.src=e,r})).catch((t=>(wi(n),{complete:!1,width:0,height:0,src:t&&t.url||""})))},ready(){const t=this;return new Promise((i=>{!function e(n){t.pending()?setTimeout((()=>{e(!0)}),10):i(n)}(!1)}))}};const Mi=$t-1e-8;let Ri,zi,Ai,Si,Ni,Ci,Ei,$i;const Pi=(t,i)=>Ri.add(t,i),Li=(t,i)=>Pi(zi=t,Ai=i),Oi=t=>Pi(t,Ri.y1),qi=t=>Pi(Ri.x1,t),Ii=(t,i)=>Ni*t+Ei*i,Di=(t,i)=>Ci*t+$i*i,Vi=(t,i)=>Pi(Ii(t,i),Di(t,i)),Hi=(t,i)=>Li(Ii(t,i),Di(t,i));function ji(t,i){return Ri=t,i?(Si=i*Ct,Ni=$i=Math.cos(Si),Ci=Math.sin(Si),Ei=-Ci):(Ni=$i=1,Si=Ci=Ei=0),Bi}const Bi={beginPath(){},closePath(){},moveTo:Hi,lineTo:Hi,rect(t,i,e,n){Si?(Vi(t+e,i),Vi(t+e,i+n),Vi(t,i+n),Hi(t,i)):(Pi(t+e,i+n),Li(t,i))},quadraticCurveTo(t,i,e,n){const s=Ii(t,i),r=Di(t,i),o=Ii(e,n),h=Di(e,n);Gi(zi,s,o,Oi),Gi(Ai,r,h,qi),Li(o,h)},bezierCurveTo(t,i,e,n,s,r){const o=Ii(t,i),h=Di(t,i),a=Ii(e,n),l=Di(e,n),c=Ii(s,r),u=Di(s,r);Wi(zi,o,a,c,Oi),Wi(Ai,h,l,u,qi),Li(c,u)},arc(t,i,e,n,s,r){if(n+=Si,s+=Si,zi=e*Math.cos(s)+t,Ai=e*Math.sin(s)+i,Math.abs(s-n)>Mi)Pi(t-e,i-e),Pi(t+e,i+e);else{const o=n=>Pi(e*Math.cos(n)+t,e*Math.sin(n)+i);let h,a;if(o(n),o(s),s!==n)if((n%=$t)<0&&(n+=$t),(s%=$t)<0&&(s+=$t),s<n&&(r=!r,h=n,n=s,s=h),r)for(s-=$t,h=n-n%Et,a=0;a<4&&h>s;++a,h-=Et)o(h);else for(h=n-n%Et+Et,a=0;a<4&&h<s;++a,h+=Et)o(h)}}};function Gi(t,i,e,n){const s=(t-i)/(t+e-2*i);0<s&&s<1&&n(t+(i-t)*s)}function Wi(t,i,e,n,s){const r=n-t+3*i-3*e,o=t+e-2*i,h=t-i;let a,l=0,c=0;Math.abs(r)>1e-14?(a=o*o+h*r,a>=0&&(a=Math.sqrt(a),l=(-o+a)/r,c=(-o-a)/r)):l=.5*h/o,0<l&&l<1&&s(Xi(l,t,i,e,n)),0<c&&c<1&&s(Xi(c,t,i,e,n))}function Xi(t,i,e,n,s){const r=1-t,o=r*r,h=t*t;return o*r*i+3*o*t*e+3*r*h*n+h*t*s}var Ui=(Ui=e.canvas(1,1))?Ui.getContext("2d"):null;const Fi=new gi;function Yi(t){return function(i,e){if(!Ui)return!0;t(Ui,i),Fi.clear().union(i.bounds).intersect(e).round();const{x1:n,y1:s,x2:r,y2:o}=Fi;for(let t=s;t<=o;++t)for(let i=n;i<=r;++i)if(Ui.isPointInPath(i,t))return!0;return!1}}function Ji(t,i){return i.contains(t.x||0,t.y||0)}function Zi(t,i){const e=t.x||0,n=t.y||0,s=t.width||0,r=t.height||0;return i.intersects(Fi.set(e,n,e+s,n+r))}function Qi(t,i){const e=t.x||0,n=t.y||0;return Ki(i,e,n,null!=t.x2?t.x2:e,null!=t.y2?t.y2:n)}function Ki(t,i,e,n,s){const{x1:r,y1:o,x2:h,y2:a}=t,l=n-i,c=s-e;let u,_,f,d,p=0,y=1;for(d=0;d<4;++d){if(0===d&&(u=-l,_=-(r-i)),1===d&&(u=l,_=h-i),2===d&&(u=-c,_=-(o-e)),3===d&&(u=c,_=a-e),Math.abs(u)<1e-10&&_<0)return!1;if(f=_/u,u<0){if(f>y)return!1;f>p&&(p=f)}else if(u>0){if(f<p)return!1;f<y&&(y=f)}}return!0}function te(t,i){t.globalCompositeOperation=i.blend||"source-over"}function ie(t,i){return null==t?i:t}function ee(t,i){const e=i.length;for(let n=0;n<e;++n)t.addColorStop(i[n].offset,i[n].color);return t}function ne(t,i,n){const s=n.width(),r=n.height();let o;if("radial"===i.gradient)o=t.createRadialGradient(n.x1+ie(i.x1,.5)*s,n.y1+ie(i.y1,.5)*r,Math.max(s,r)*ie(i.r1,0),n.x1+ie(i.x2,.5)*s,n.y1+ie(i.y2,.5)*r,Math.max(s,r)*ie(i.r2,.5));else{const h=ie(i.x1,0),a=ie(i.y1,0),l=ie(i.x2,1),c=ie(i.y2,0);if(h!==l&&a!==c&&s!==r){const n=e.canvas(Math.ceil(s),Math.ceil(r)),o=n.getContext("2d");return o.scale(s,r),o.fillStyle=ee(o.createLinearGradient(h,a,l,c),i.stops),o.fillRect(0,0,s,r),t.createPattern(n,"no-repeat")}o=t.createLinearGradient(n.x1+h*s,n.y1+a*r,n.x1+l*s,n.y1+c*r)}return ee(o,i.stops)}function se(t,i,e){return h(e)?ne(t,e,i.bounds):e}function re(t,i,e){return(e*=null==i.fillOpacity?1:i.fillOpacity)>0&&(t.globalAlpha=e,t.fillStyle=se(t,i,i.fill),!0)}var oe=[];function he(t,i,e){var n=null!=(n=i.strokeWidth)?n:1;return!(n<=0)&&((e*=null==i.strokeOpacity?1:i.strokeOpacity)>0&&(t.globalAlpha=e,t.strokeStyle=se(t,i,i.stroke),t.lineWidth=n,t.lineCap=i.strokeCap||"butt",t.lineJoin=i.strokeJoin||"miter",t.miterLimit=i.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(i.strokeDash||oe),t.lineDashOffset=i.strokeDashOffset||0),!0))}function ae(t,i){return t.zindex-i.zindex||t.index-i.index}function le(t){if(!t.zdirty)return t.zitems;var i,e,n,s=t.items,r=[];for(e=0,n=s.length;e<n;++e)(i=s[e]).index=e,i.zindex&&r.push(i);return t.zdirty=!1,t.zitems=r.sort(ae)}function ce(t,i){var e,n,s=t.items;if(!s||!s.length)return;const r=le(t);if(r&&r.length){for(e=0,n=s.length;e<n;++e)s[e].zindex||i(s[e]);s=r}for(e=0,n=s.length;e<n;++e)i(s[e])}function ue(t,i){var e,n,s=t.items;if(!s||!s.length)return null;const r=le(t);for(r&&r.length&&(s=r),n=s.length;--n>=0;)if(e=i(s[n]))return e;if(s===r)for(n=(s=t.items).length;--n>=0;)if(!s[n].zindex&&(e=i(s[n])))return e;return null}function _e(t){return function(i,e,n){ce(e,(e=>{n&&!n.intersects(e.bounds)||de(t,i,e,e)}))}}function fe(t){return function(i,e,n){!e.items.length||n&&!n.intersects(e.bounds)||de(t,i,e.items[0],e.items)}}function de(t,i,e,n){var s=null==e.opacity?1:e.opacity;0!==s&&(t(i,n)||(te(i,e),e.fill&&re(i,e,s)&&i.fill(),e.stroke&&he(i,e,s)&&i.stroke()))}function pe(t){return t=t||i.truthy,function(i,e,n,s,r,o){return n*=i.pixelRatio,s*=i.pixelRatio,ue(e,(e=>{const h=e.bounds;if((!h||h.contains(r,o))&&h)return t(i,e,n,s,r,o)?e:void 0}))}}function ye(t,i){return function(e,n,s,r){var o,h,a=Array.isArray(n)?n[0]:n,l=null==i?a.fill:i,c=a.stroke&&e.isPointInStroke;return c&&(o=a.strokeWidth,h=a.strokeCap,e.lineWidth=null!=o?o:1,e.lineCap=null!=h?h:"butt"),!t(e,n)&&(l&&e.isPointInPath(s,r)||c&&e.isPointInStroke(s,r))}}function xe(t){return pe(ye(t))}function ge(t,i){return"translate("+t+","+i+")"}function ve(t){return"rotate("+t+")"}function me(t){return ge(t.x||0,t.y||0)}function be(t,i,e){function n(t,e){var n=e.x||0,s=e.y||0,r=e.angle||0;t.translate(n,s),r&&t.rotate(r*=Ct),t.beginPath(),i(t,e),r&&t.rotate(-r),t.translate(-n,-s)}return{type:t,tag:"path",nested:!1,attr:function(t,e){t("transform",function(t){return ge(t.x||0,t.y||0)+(t.angle?" "+ve(t.angle):"")}(e)),t("d",i(null,e))},bound:function(t,e){return i(ji(t,e.angle),e),Ti(t,e).translate(e.x||0,e.y||0)},draw:_e(n),pick:xe(n),isect:e||Yi(n)}}var ke=be("arc",(function(t,i){return oi.context(t)(i)}));function we(t,i,e){function n(t,e){t.beginPath(),i(t,e)}const s=ye(n);return{type:t,tag:"path",nested:!0,attr:function(t,e){var n=e.mark.items;n.length&&t("d",i(null,n))},bound:function(t,e){var n=e.items;return 0===n.length?t:(i(ji(t),n),Ti(t,n[0]))},draw:fe(n),pick:function(t,i,e,n,r,o){var h=i.items,a=i.bounds;return!h||!h.length||a&&!a.contains(r,o)?null:(e*=t.pixelRatio,n*=t.pixelRatio,s(t,h,e,n)?h[0]:null)},isect:Ji,tip:e}}var Te=we("area",(function(t,i){const e=i[0],n=e.interpolate||"linear";return("horizontal"===e.orient?ai:hi).curve(Tt(n,e.orient,e.tension)).context(t)(i)}),(function(t,i){for(var e,n,s="horizontal"===t[0].orient?i[1]:i[0],r="horizontal"===t[0].orient?"y":"x",o=t.length,h=1/0;--o>=0;)!1!==t[o].defined&&(n=Math.abs(t[o][r]-s))<h&&(h=n,e=t[o]);return e}));function Me(t,i){t.beginPath(),fi(i)?di(t,i,0,0):t.rect(0,0,i.width||0,i.height||0),t.clip()}function Re(t){const i=ie(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&i>.5&&i<1.5?.5-Math.abs(i-1):0}function ze(t,i){const e=Re(i);t("d",di(null,i,e,e))}function Ae(t,i,e,n){const s=Re(i);t.beginPath(),di(t,i,(e||0)+s,(n||0)+s)}const Se=ye(Ae),Ne=ye(Ae,!1),Ce=ye(Ae,!0);var Ee={type:"group",tag:"g",nested:!1,attr:function(t,i){t("transform",me(i))},bound:function(t,i){if(!i.clip&&i.items){const e=i.items,n=e.length;for(let i=0;i<n;++i)t.union(e[i].bounds)}return(i.clip||i.width||i.height)&&!i.noBound&&t.add(0,0).add(i.width||0,i.height||0),Ti(t,i),t.translate(i.x||0,i.y||0)},draw:function(t,i,e,n){ce(i,(i=>{const s=i.x||0,r=i.y||0,o=i.strokeForeground,h=null==i.opacity?1:i.opacity;(i.stroke||i.fill)&&h&&(Ae(t,i,s,r),te(t,i),i.fill&&re(t,i,h)&&t.fill(),i.stroke&&!o&&he(t,i,h)&&t.stroke()),t.save(),t.translate(s,r),i.clip&&Me(t,i),e&&e.translate(-s,-r),ce(i,(i=>{("group"===i.marktype||null==n||n.includes(i.marktype))&&this.draw(t,i,e,n)})),e&&e.translate(s,r),t.restore(),o&&i.stroke&&h&&(Ae(t,i,s,r),te(t,i),he(t,i,h)&&t.stroke())}))},pick:function(t,i,e,n,s,r){if(i.bounds&&!i.bounds.contains(s,r)||!i.items)return null;const o=e*t.pixelRatio,h=n*t.pixelRatio;return ue(i,(a=>{let l,c,u;const _=a.bounds;if(_&&!_.contains(s,r))return;c=a.x||0,u=a.y||0;const f=c+(a.width||0),d=u+(a.height||0),p=a.clip;if(p&&(s<c||s>f||r<u||r>d))return;if(t.save(),t.translate(c,u),c=s-c,u=r-u,p&&fi(a)&&!Ce(t,a,o,h))return t.restore(),null;const y=a.strokeForeground,x=!1!==i.interactive;return x&&y&&a.stroke&&Ne(t,a,o,h)?(t.restore(),a):(l=ue(a,(t=>function(t,i,e){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(i,e)}(t,c,u)?this.pick(t,e,n,c,u):null)),!l&&x&&(a.fill||!y&&a.stroke)&&Se(t,a,o,h)&&(l=a),t.restore(),l||null)}))},isect:Zi,content:function(t,i,e){t("clip-path",i.clip?xi(e,i,i):null)},background:function(t,i){t("class","background"),t("aria-hidden",!0),ze(t,i)},foreground:function(t,i){t("class","foreground"),t("aria-hidden",!0),i.strokeForeground?ze(t,i):t("d","")}},$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Pe(t,i){var e=t.image;return(!e||t.url&&t.url!==e.url)&&(e={complete:!1,width:0,height:0},i.loadImage(t.url).then((i=>{t.image=i,t.image.url=t.url}))),e}function Le(t,i){return null!=t.width?t.width:i&&i.width?!1!==t.aspect&&t.height?t.height*i.width/i.height:i.width:0}function Oe(t,i){return null!=t.height?t.height:i&&i.height?!1!==t.aspect&&t.width?t.width*i.height/i.width:i.height:0}function qe(t,i){return"center"===t?i/2:"right"===t?i:0}function Ie(t,i){return"middle"===t?i/2:"bottom"===t?i:0}var De={type:"image",tag:"image",nested:!1,attr:function(t,i,e){const n=Pe(i,e),s=Le(i,n),r=Oe(i,n),o=(i.x||0)-qe(i.align,s),h=(i.y||0)-Ie(i.baseline,r);t("href",!n.src&&n.toDataURL?n.toDataURL():n.src||"",$e["xmlns:xlink"],"xlink:href"),t("transform",ge(o,h)),t("width",s),t("height",r),t("preserveAspectRatio",!1===i.aspect?"none":"xMidYMid")},bound:function(t,i){const e=i.image,n=Le(i,e),s=Oe(i,e),r=(i.x||0)-qe(i.align,n),o=(i.y||0)-Ie(i.baseline,s);return t.set(r,o,r+n,o+s)},draw:function(t,i,e){ce(i,(i=>{if(e&&!e.intersects(i.bounds))return;const n=Pe(i,this);let s=Le(i,n),r=Oe(i,n);if(0===s||0===r)return;let o,h,a,l,c=(i.x||0)-qe(i.align,s),u=(i.y||0)-Ie(i.baseline,r);!1!==i.aspect&&(h=n.width/n.height,a=i.width/i.height,h==h&&a==a&&h!==a&&(a<h?(l=s/h,u+=(r-l)/2,r=l):(l=r*h,c+=(s-l)/2,s=l))),(n.complete||n.toDataURL)&&(te(t,i),t.globalAlpha=null!=(o=i.opacity)?o:1,t.imageSmoothingEnabled=!1!==i.smooth,t.drawImage(n,c,u,s,r))}))},pick:pe(),isect:i.truthy,get:Pe,xOffset:qe,yOffset:Ie},Ve=we("line",(function(t,i){const e=i[0],n=e.interpolate||"linear";return li.curve(Tt(n,e.orient,e.tension)).context(t)(i)}),(function(t,i){for(var e,n,s=Math.pow(t[0].strokeWidth||1,2),r=t.length;--r>=0;)if(!1!==t[r].defined&&(e=t[r].x-i[0])*e+(n=t[r].y-i[1])*n<s)return t[r];return null}));function He(t,i){var e=i.path;if(null==e)return!0;var n=i.x||0,s=i.y||0,r=i.scaleX||1,o=i.scaleY||1,h=(i.angle||0)*Ct,a=i.pathCache;a&&a.path===e||((i.pathCache=a=Nt(e)).path=e),h&&t.rotate&&t.translate?(t.translate(n,s),t.rotate(h),Ht(t,a,0,0,r,o),t.rotate(-h),t.translate(-n,-s)):Ht(t,a,n,s,r,o)}var je={type:"path",tag:"path",nested:!1,attr:function(t,i){var e=i.scaleX||1,n=i.scaleY||1;1===e&&1===n||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return ge(t.x||0,t.y||0)+(t.angle?" "+ve(t.angle):"")+(t.scaleX||t.scaleY?" "+(i=t.scaleX||1,e=t.scaleY||1,"scale("+i+","+e+")"):"");var i,e}(i)),t("d",i.path)},bound:function(t,i){return He(ji(t,i.angle),i)?t.set(0,0,0,0):Ti(t,i,!0)},draw:_e(He),pick:xe(He),isect:Yi(He)};function Be(t,i){t.beginPath(),di(t,i)}var Ge={type:"rect",tag:"path",nested:!1,attr:function(t,i){t("d",di(null,i))},bound:function(t,i){var e,n;return Ti(t.set(e=i.x||0,n=i.y||0,e+i.width||0,n+i.height||0),i)},draw:_e(Be),pick:xe(Be),isect:Zi};function We(t,i,e){var n,s,r,o;return!(!i.stroke||!he(t,i,e))&&(n=i.x||0,s=i.y||0,r=null!=i.x2?i.x2:n,o=null!=i.y2?i.y2:s,t.beginPath(),t.moveTo(n,s),t.lineTo(r,o),!0)}var Xe={type:"rule",tag:"line",nested:!1,attr:function(t,i){t("transform",me(i)),t("x2",null!=i.x2?i.x2-(i.x||0):0),t("y2",null!=i.y2?i.y2-(i.y||0):0)},bound:function(t,i){var e,n;return Ti(t.set(e=i.x||0,n=i.y||0,null!=i.x2?i.x2:e,null!=i.y2?i.y2:n),i)},draw:function(t,i,e){ce(i,(i=>{if(!e||e.intersects(i.bounds)){var n=null==i.opacity?1:i.opacity;n&&We(t,i,n)&&(te(t,i),t.stroke())}}))},pick:pe((function(t,i,e,n){return!!t.isPointInStroke&&(We(t,i,1)&&t.isPointInStroke(e,n))})),isect:Qi},Ue=be("shape",(function(t,i){return(i.mark.shape||i.shape).context(t)(i)})),Fe=be("symbol",(function(t,i){return ui.context(t)(i)}),Ji);const Ye=i.lruCache();var Je={height:nn,measureWidth:tn,estimateWidth:Qe,width:Qe,canvas:Ze};function Ze(t){Je.width=t&&Ui?tn:Qe}function Qe(t,i){return Ke(on(t,i),nn(t))}function Ke(t,i){return~~(.8*t.length*i)}function tn(t,i){return nn(t)<=0||!(i=on(t,i))?0:en(i,an(t))}function en(t,i){const e=`(${i}) ${t}`;let n=Ye.get(e);return void 0===n&&(Ui.font=i,n=Ui.measureText(t).width,Ye.set(e,n)),n}function nn(t){return null!=t.fontSize?+t.fontSize||0:11}function sn(t){return null!=t.lineHeight?t.lineHeight:nn(t)+2}function rn(t){return e=t.lineBreak&&t.text&&!i.isArray(t.text)?t.text.split(t.lineBreak):t.text,i.isArray(e)?e.length>1?e:e[0]:e;var e}function on(t,i){const e=null==i?"":(i+"").trim();return t.limit>0&&e.length?function(t,i){var e=+t.limit,n=function(t){if(Je.width===tn){const i=an(t);return t=>en(t,i)}if(Je.width===Qe){const i=nn(t);return t=>Ke(t,i)}return i=>Je.width(t,i)}(t);if(n(i)<e)return i;var s,r=t.ellipsis||"",o="rtl"===t.dir,h=0,a=i.length;if(e-=n(r),o){for(;h<a;)s=h+a>>>1,n(i.slice(s))>e?h=s+1:a=s;return r+i.slice(h)}for(;h<a;)s=1+(h+a>>>1),n(i.slice(0,s))<e?h=s:a=s-1;return i.slice(0,h)+r}(t,e):e}function hn(t,i){var e=t.font;return(i&&e?String(e).replace(/"/g,"'"):e)||"sans-serif"}function an(t,i){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+nn(t)+"px "+hn(t,i)}function ln(t){var i=t.baseline,e=nn(t);return Math.round("top"===i?.79*e:"middle"===i?.3*e:"bottom"===i?-.21*e:"line-top"===i?.29*e+.5*sn(t):"line-bottom"===i?.29*e-.5*sn(t):0)}Ze(!0);const cn={left:"start",center:"middle",right:"end"},un=new gi;function _n(t){var i,e=t.x||0,n=t.y||0,s=t.radius||0;return s&&(i=(t.theta||0)-Et,e+=s*Math.cos(i),n+=s*Math.sin(i)),un.x1=e,un.y1=n,un}function fn(t,e,n){var s,r=Je.height(e),o=e.align,h=_n(e),a=h.x1,l=h.y1,c=e.dx||0,u=(e.dy||0)+ln(e)-Math.round(.8*r),_=rn(e);if(i.isArray(_)?(r+=sn(e)*(_.length-1),s=_.reduce(((t,i)=>Math.max(t,Je.width(e,i))),0)):s=Je.width(e,_),"center"===o?c-=s/2:"right"===o&&(c-=s),t.set(c+=a,u+=l,c+s,u+r),e.angle&&!n)t.rotate(e.angle*Ct,a,l);else if(2===n)return t.rotatedPoints(e.angle*Ct,a,l);return t}var dn={type:"text",tag:"text",nested:!1,attr:function(t,i){var e,n=i.dx||0,s=(i.dy||0)+ln(i),r=_n(i),o=r.x1,h=r.y1,a=i.angle||0;t("text-anchor",cn[i.align]||"start"),a?(e=ge(o,h)+" "+ve(a),(n||s)&&(e+=" "+ge(n,s))):e=ge(o+n,h+s),t("transform",e)},bound:fn,draw:function(t,e,n){ce(e,(e=>{var s,r,o,h,a,l,c,u=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===u||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=an(e),t.textAlign=e.align||"left",r=(s=_n(e)).x1,o=s.y1,e.angle&&(t.save(),t.translate(r,o),t.rotate(e.angle*Ct),r=o=0),r+=e.dx||0,o+=(e.dy||0)+ln(e),l=rn(e),te(t,e),i.isArray(l))for(a=sn(e),h=0;h<l.length;++h)c=on(e,l[h]),e.fill&&re(t,e,u)&&t.fillText(c,r,o),e.stroke&&he(t,e,u)&&t.strokeText(c,r,o),o+=a;else c=on(e,l),e.fill&&re(t,e,u)&&t.fillText(c,r,o),e.stroke&&he(t,e,u)&&t.strokeText(c,r,o);e.angle&&t.restore()}}))},pick:pe((function(t,i,e,n,s,r){if(i.fontSize<=0)return!1;if(!i.angle)return!0;var o=_n(i),h=o.x1,a=o.y1,l=fn(un,i,1),c=-i.angle*Ct,u=Math.cos(c),_=Math.sin(c),f=u*s-_*r+(h-u*h+_*a),d=_*s+u*r+(a-_*h-u*a);return l.contains(f,d)})),isect:function(t,i){const e=fn(un,t,2);return Ki(i,e[0],e[1],e[2],e[3])||Ki(i,e[0],e[1],e[4],e[5])||Ki(i,e[4],e[5],e[6],e[7])||Ki(i,e[2],e[3],e[6],e[7])}},pn=we("trail",(function(t,i){return _i.context(t)(i)}),(function(t,i){for(var e,n,s=t.length;--s>=0;)if(!1!==t[s].defined&&(e=t[s].x-i[0])*e+(n=t[s].y-i[1])*n<(e=t[s].size||1)*e)return t[s];return null})),yn={arc:ke,area:Te,group:Ee,image:De,line:Ve,path:je,rect:Ge,rule:Xe,shape:Ue,symbol:Fe,text:dn,trail:pn};function xn(t,i,e){var n=yn[t.mark.marktype],s=i||n.bound;return n.nested&&(t=t.mark),s(t.bounds||(t.bounds=new gi),t,e)}var gn={mark:null};function vn(t,i,e){var n,s,r,o,h=yn[t.marktype],a=h.bound,l=t.items,c=l&&l.length;if(h.nested)return c?r=l[0]:(gn.mark=t,r=gn),o=xn(r,a,e),i=i&&i.union(o)||o;if(i=i||t.bounds&&t.bounds.clear()||new gi,c)for(n=0,s=l.length;n<s;++n)i.union(xn(l[n],a,e));return t.bounds=i}const mn=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function bn(t,i){return JSON.stringify(t,mn,i)}function kn(t){return wn("string"==typeof t?JSON.parse(t):t)}function wn(t){var i,e,n,s=t.marktype,r=t.items;if(r)for(e=0,n=r.length;e<n;++e)i=s?"mark":"group",r[e][i]=t,r[e].zindex&&(r[e][i].zdirty=!0),"group"===(s||i)&&wn(r[e]);return s&&vn(t),t}function Tn(t){arguments.length?this.root=kn(t):(this.root=Mn({marktype:"group",name:"root",role:"frame"}),this.root.items=[new mi(this.root)])}function Mn(t,i){const e={bounds:new gi,clip:!!t.clip,group:i,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(e.aria=t.aria),t.description&&(e.description=t.description),e}function Rn(t,i,e){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?e?t.createElementNS(e,i):t.createElement(i):null}function zn(t,i){i=i.toLowerCase();for(var e=t.childNodes,n=0,s=e.length;n<s;++n)if(e[n].tagName.toLowerCase()===i)return e[n]}function An(t,i,e,n){var s,r=t.childNodes[i];return r&&r.tagName.toLowerCase()===e.toLowerCase()||(s=r||null,r=Rn(t.ownerDocument,e,n),t.insertBefore(r,s)),r}function Sn(t,i){for(var e=t.childNodes,n=e.length;n>i;)t.removeChild(e[--n]);return t}function Nn(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function Cn(t,i){const e=i.getBoundingClientRect();return[t.clientX-e.left-(i.clientLeft||0),t.clientY-e.top-(i.clientTop||0)]}function En(t,i){this._active=null,this._handlers={},this._loader=t||n.loader(),this._tooltip=i||$n}function $n(t,i,e,n){t.element().setAttribute("title",n||"")}function Pn(t){this._el=null,this._bgcolor=null,this._loader=new bi(t)}Tn.prototype={toJSON(t){return bn(this.root,t||0)},mark(t,i,e){const n=Mn(t,i=i||this.root.items[0]);return i.items[e]=n,n.zindex&&(n.group.zdirty=!0),n}},En.prototype={initialize(t,i,e){return this._el=t,this._obj=e||null,this.origin(i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,i,e){for(let n=t?t.length:0;--n>=0;)if(t[n].type===i&&(!e||t[n].handler===e))return n;return-1},handlers(t){const i=this._handlers,e=[];if(t)e.push(...i[this.eventName(t)]);else for(const t in i)e.push(...i[t]);return e},eventName(t){const i=t.indexOf(".");return i<0?t:t.slice(0,i)},handleHref(t,i,e){this._loader.sanitize(e,{context:"href"}).then((i=>{const e=new MouseEvent(t.type,t),n=Rn(null,"a");for(const t in i)n.setAttribute(t,i[t]);n.dispatchEvent(e)})).catch((()=>{}))},handleTooltip(t,i,e){if(i&&null!=i.tooltip){i=function(t,i,e,n){var s,r,o=t&&t.mark;if(o&&(s=yn[o.marktype]).tip){for((r=Cn(i,e))[0]-=n[0],r[1]-=n[1];t=t.mark.group;)r[0]-=t.x||0,r[1]-=t.y||0;t=s.tip(o.items,r)}return t}(i,t,this.canvas(),this._origin);const n=e&&i&&i.tooltip||null;this._tooltip.call(this._obj,this,t,i,n)}},getItemBoundingClientRect(t){const i=this.canvas();if(!i)return;const e=i.getBoundingClientRect(),n=this._origin,s=t.bounds,r=s.width(),o=s.height();let h=s.x1+n[0]+e.left,a=s.y1+n[1]+e.top;for(;t.mark&&(t=t.mark.group);)h+=t.x||0,a+=t.y||0;return{x:h,y:a,width:r,height:o,left:h,top:a,right:h+r,bottom:a+o}}},Pn.prototype={initialize(t,i,e,n,s){return this._el=t,this.resize(i,e,n,s)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},resize(t,i,e,n){return this._width=t,this._height=i,this._origin=e||[0,0],this._scale=n||1,this},dirty(){},render(t,i){const e=this;return e._call=function(){e._render(t,i)},e._call(),e._call=null,e},_render(){},renderAsync(t,i){const e=this.render(t,i);return this._ready?this._ready.then((()=>e)):Promise.resolve(e)},_load(t,i){var e=this,n=e._loader[t](i);if(!e._ready){const t=e._call;e._ready=e._loader.ready().then((i=>{i&&t(),e._ready=null}))}return n},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const Ln="dragenter",On="dragleave",qn="dragover",In="pointerdown",Dn="pointermove",Vn="pointerout",Hn="pointerover",jn="mousedown",Bn="mousemove",Gn="mouseout",Wn="mouseover",Xn="click",Un="mousewheel",Fn="touchstart",Yn="touchmove",Jn="touchend",Zn=["keydown","keypress","keyup",Ln,On,qn,In,"pointerup",Dn,Vn,Hn,jn,"mouseup",Bn,Gn,Wn,Xn,"dblclick","wheel",Un,Fn,Yn,Jn],Qn=Dn,Kn=Vn,ts=Xn;function is(t,i){En.call(this,t,i),this._down=null,this._touch=null,this._first=!0,this._events={}}function es(t,i){(t=>t===Fn||t===Yn||t===Jn?[Fn,Yn,Jn]:[t])(i).forEach((i=>function(t,i){const e=t.canvas();e&&!t._events[i]&&(t._events[i]=1,e.addEventListener(i,t[i]?e=>t[i](e):e=>t.fire(i,e)))}(t,i)))}function ns(t,i,e){i.forEach((i=>t.fire(i,e)))}function ss(t,i,e){return function(n){const s=this._active,r=this.pickEvent(n);r===s||(s&&s.exit||ns(this,e,n),this._active=r,ns(this,i,n)),ns(this,t,n)}}function rs(t){return function(i){ns(this,t,i),this._active=null}}function os(t,i,e,n,s,r){const o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,h=t.getContext("2d"),a=o?"undefined"!=typeof window&&window.devicePixelRatio||1:s;t.width=i*a,t.height=e*a;for(const t in r)h[t]=r[t];return o&&1!==a&&(t.style.width=i+"px",t.style.height=e+"px"),h.pixelRatio=a,h.setTransform(a,0,0,a,a*n[0],a*n[1]),t}function hs(t){Pn.call(this,t),this._options={},this._redraw=!1,this._dirty=new gi,this._tempb=new gi}i.inherits(is,En,{initialize(t,i,e){return this._canvas=t&&zn(t,"canvas"),[Xn,jn,In,Dn,Vn,On].forEach((t=>es(this,t))),En.prototype.initialize.call(this,t,i,e)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Zn,DOMMouseScroll(t){this.fire(Un,t)},pointermove:ss([Dn,Bn],[Hn,Wn],[Vn,Gn]),dragover:ss([qn],[Ln],[On]),pointerout:rs([Vn,Gn]),dragleave:rs([On]),pointerdown(t){this._down=this._active,this.fire(In,t)},mousedown(t){this._down=this._active,this.fire(jn,t)},click(t){this._down===this._active&&(this.fire(Xn,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Fn,t,!0)},touchmove(t){this.fire(Yn,t,!0)},touchend(t){this.fire(Jn,t,!0),this._touch=null},fire(t,i,e){const n=e?this._touch:this._active,s=this._handlers[t];if(i.vegaType=t,t===ts&&n&&n.href?this.handleHref(i,n,n.href):t!==Qn&&t!==Kn||this.handleTooltip(i,n,t!==Kn),s)for(let t=0,e=s.length;t<e;++t)s[t].handler.call(this._obj,i,n)},on(t,i){const e=this.eventName(t),n=this._handlers;return this._handlerIndex(n[e],t,i)<0&&(es(this,t),(n[e]||(n[e]=[])).push({type:t,handler:i})),this},off(t,i){const e=this.eventName(t),n=this._handlers[e],s=this._handlerIndex(n,t,i);return s>=0&&n.splice(s,1),this},pickEvent(t){const i=Cn(t,this._canvas),e=this._origin;return this.pick(this._scene,i[0],i[1],i[0]-e[0],i[1]-e[1])},pick(t,i,e,n,s){const r=this.context();return yn[t.marktype].pick.call(this,r,t,i,e,n,s)}});const as=Pn.prototype;function ls(t,i){En.call(this,t,i);const e=this;e._hrefHandler=cs(e,((t,i)=>{i&&i.href&&e.handleHref(t,i,i.href)})),e._tooltipHandler=cs(e,((t,i)=>{e.handleTooltip(t,i,t.type!==Kn)}))}i.inherits(hs,Pn,{initialize(t,i,n,s,r,o){return this._options=o||{},this._canvas=this._options.externalContext?null:e.canvas(1,1,this._options.type),t&&this._canvas&&(Sn(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),as.initialize.call(this,t,i,n,s,r)},resize(t,e,n,s){if(as.resize.call(this,t,e,n,s),this._canvas)os(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||i.error("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const i=this._tempb.clear().union(t.bounds);let e=t.mark.group;for(;e;)i.translate(e.x||0,e.y||0),e=e.mark.group;this._dirty.union(i)},_render(t,i){const e=this.context(),n=this._origin,s=this._width,r=this._height,o=this._dirty,h=(a=n,l=s,c=r,(new gi).set(0,0,l,c).translate(-a[0],-a[1]));var a,l,c;e.save();const u=this._redraw||o.empty()?(this._redraw=!1,h.expand(1)):function(t,i,e){return i.expand(1).round(),t.pixelRatio%1&&i.scale(t.pixelRatio).round().scale(1/t.pixelRatio),i.translate(-e[0]%1,-e[1]%1),t.beginPath(),t.rect(i.x1,i.y1,i.width(),i.height()),t.clip(),i}(e,h.intersect(o),n);return this.clear(-n[0],-n[1],s,r),this.draw(e,t,u,i),e.restore(),o.clear(),this},draw(t,e,n,s){if("group"!==e.marktype&&null!=s&&!s.includes(e.marktype))return;const r=yn[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),i.isFunction(n)?(t.beginPath(),n(t),t.clip()):Me(t,e.group)}(t,e),r.draw.call(this,t,e,n,s),e.clip&&t.restore()},clear(t,i,e,n){const s=this._options,r=this.context();"pdf"===s.type||s.externalContext||r.clearRect(t,i,e,n),null!=this._bgcolor&&(r.fillStyle=this._bgcolor,r.fillRect(t,i,e,n))}});const cs=(t,i)=>e=>{let n=e.target.__data__;n=Array.isArray(n)?n[0]:n,e.vegaType=e.type,i.call(t._obj,e,n)};i.inherits(ls,En,{initialize(t,i,e){let n=this._svg;return n&&(n.removeEventListener(ts,this._hrefHandler),n.removeEventListener(Qn,this._tooltipHandler),n.removeEventListener(Kn,this._tooltipHandler)),this._svg=n=t&&zn(t,"svg"),n&&(n.addEventListener(ts,this._hrefHandler),n.addEventListener(Qn,this._tooltipHandler),n.addEventListener(Kn,this._tooltipHandler)),En.prototype.initialize.call(this,t,i,e)},canvas(){return this._svg},on(t,i){const e=this.eventName(t),n=this._handlers;if(this._handlerIndex(n[e],t,i)<0){const s={type:t,handler:i,listener:cs(this,i)};(n[e]||(n[e]=[])).push(s),this._svg&&this._svg.addEventListener(e,s.listener)}return this},off(t,i){const e=this.eventName(t),n=this._handlers[e],s=this._handlerIndex(n,t,i);return s>=0&&(this._svg&&this._svg.removeEventListener(e,n[s].listener),n.splice(s,1)),this}});const us="aria-hidden",_s="aria-label",fs="role",ds="aria-roledescription",ps="graphics-object",ys="graphics-symbol",xs=(t,i,e)=>({[fs]:t,[ds]:i,[_s]:e||void 0}),gs=i.toSet(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),vs={axis:{desc:"axis",caption:function(t){const i=t.datum,e=t.orient,n=i.title?Ts(t):null,r=t.context,o=r.scales[i.scale].value,h=r.dataflow.locale(),a=o.type;return("left"===e||"right"===e?"Y":"X")+"-axis"+(n?` titled '${n}'`:"")+` for a ${s.isDiscrete(a)?"discrete":a} scale`+` with ${s.domainCaption(h,o,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Ts(t):null,r=`${e.type||""} legend`.trim(),o=e.scales,h=Object.keys(o),a=t.context,l=a.scales[o[h[0]]].value,c=a.dataflow.locale();return u=r,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?` titled '${n}'`:"")+` for ${function(t){return t=t.map((t=>t+("fill"===t||"stroke"===t?" color":""))),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+i.peek(t)}(h)}`+` with ${s.domainCaption(c,l,t)}`;var u}},"title-text":{desc:"title",caption:t=>`Title text '${ws(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${ws(t)}'`}},ms={ariaRole:fs,ariaRoleDescription:ds,description:_s};function bs(t,i){const e=!1===i.aria;if(t(us,e||void 0),e||null==i.description)for(const i in ms)t(ms[i],void 0);else{const e=i.mark.marktype;t(_s,i.description),t(fs,i.ariaRole||("group"===e?ps:ys)),t(ds,i.ariaRoleDescription||`${e} mark`)}}function ks(t){return!1===t.aria?{[us]:!0}:gs[t.role]?null:vs[t.role]?function(t,i){try{const e=t.items[0],n=i.caption||(()=>"");return xs(i.role||ys,i.desc,e.description||n(e))}catch(t){return null}}(t,vs[t.role]):function(t){const i=t.marktype,e="group"===i||"text"===i||t.items.some((t=>null!=t.description&&!1!==t.aria));return xs(e?ps:ys,`${i} mark container`,t.description)}(t)}function ws(t){return i.array(t.text).join(" ")}function Ts(t){try{return i.array(i.peek(t.items).items[0].text).join(" ")}catch(t){return null}}const Ms=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Rs(){let t="",i="",e="";const n=[],s=()=>i=e="",r=(t,e)=>{var n;return null!=e&&(i+=` ${t}="${n=e,Ms(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),o},o={open(h){(r=>{i&&(t+=`${i}>${e}`,s()),n.push(r)})(h),i="<"+h;for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];for(const t of l)for(const i in t)r(i,t[i]);return o},close(){const r=n.pop();return t+=i?i+(e?`>${e}</${r}>`:"/>"):`</${r}>`,s(),o},attr:r,text:t=>(e+=Ms(t),o),toString:()=>t};return o}const zs=t=>As(Rs(),t)+"";function As(t,i){if(t.open(i.tagName),i.hasAttributes()){const e=i.attributes,n=e.length;for(let i=0;i<n;++i)t.attr(e[i].name,e[i].value)}if(i.hasChildNodes()){const e=i.childNodes;for(const i of e)3===i.nodeType?t.text(i.nodeValue):As(t,i)}return t.close()}const Ss={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},Ns={blend:"mix-blend-mode"},Cs={fill:"none","stroke-miterlimit":10},Es="http://www.w3.org/2000/xmlns/",$s=$e.xmlns;function Ps(t){Pn.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Ls=Pn.prototype;function Os(t,i){for(;t&&t.dirty!==i;t=t.mark.group){if(t.dirty=i,!t.mark||t.mark.dirty===i)return;t.mark.dirty=i}}function qs(t,i,e){let n,s,r;if("radial"===i.gradient){let n=An(t,e++,"pattern",$s);Ws(n,{id:o+i.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),n=An(n,0,"rect",$s),Ws(n,{width:1,height:1,fill:`url(${Us()}#${i.id})`}),Ws(t=An(t,e++,"radialGradient",$s),{id:i.id,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})}else Ws(t=An(t,e++,"linearGradient",$s),{id:i.id,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(n=0,s=i.stops.length;n<s;++n)r=An(t,n,"stop",$s),r.setAttribute("offset",i.stops[n].offset),r.setAttribute("stop-color",i.stops[n].color);return Sn(t,n),e}function Is(t,i,e){let n;return(t=An(t,e,"clipPath",$s)).setAttribute("id",i.id),i.path?(n=An(t,0,"path",$s),n.setAttribute("d",i.path)):(n=An(t,0,"rect",$s),Ws(n,{x:0,y:0,width:i.width,height:i.height})),Sn(t,1),e+1}function Ds(t,i,e,n,s){let r,o=t._svg;if(!o&&(r=i.ownerDocument,o=Rn(r,n,$s),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===n))){const i=Rn(r,"path",$s);o.appendChild(i),i.__data__=t;const e=Rn(r,"g",$s);o.appendChild(e),e.__data__=t;const n=Rn(r,"path",$s);o.appendChild(n),n.__data__=t,n.__values__={fill:"default"}}return(o.ownerSVGElement!==s||function(t,i){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=i}(o,e))&&i.insertBefore(o,e?e.nextSibling:i.firstChild),o}i.inherits(Ps,Pn,{initialize(t,i,e,n,s){return this._defs={},this._clearDefs(),t&&(this._svg=An(t,0,"svg",$s),this._svg.setAttributeNS(Es,"xmlns",$s),this._svg.setAttributeNS(Es,"xmlns:xlink",$e["xmlns:xlink"]),this._svg.setAttribute("version",$e.version),this._svg.setAttribute("class","marks"),Sn(t,1),this._root=An(this._svg,0,"g",$s),Ws(this._root,Cs),Sn(this._svg,1)),this.background(this._bgcolor),Ls.initialize.call(this,t,i,e,n,s)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),Ls.background.apply(this,arguments)},resize(t,i,e,n){return Ls.resize.call(this,t,i,e,n),this._svg&&(Ws(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const t=this._svg,i=this._bgcolor;if(!t)return null;let e;i&&(t.removeAttribute("style"),e=An(t,0,"rect",$s),Ws(e,{width:this._width,height:this._height,fill:i}));const n=zs(t);return i&&(t.removeChild(e),this._svg.style.setProperty("background-color",i)),n},_render(t,i){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,i),Sn(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const i=++this._dirtyID;let e,n,s,r,o,h,a;for(o=0,h=t.length;o<h;++o)e=t[o],n=e.mark,n.marktype!==s&&(s=n.marktype,r=yn[s]),n.zdirty&&n.dirty!==i&&(this._dirtyAll=!1,Os(e,i),n.items.forEach((t=>{t.dirty=i}))),n.zdirty||(e.exit?(r.nested&&n.items.length?(a=n.items[0],a._svg&&this._update(r,a._svg,a)):e._svg&&(a=e._svg.parentNode,a&&a.removeChild(e._svg)),e._svg=null):(e=r.nested?n.items[0]:e,e._update!==i&&(e._svg&&e._svg.ownerSVGElement?this._update(r,e._svg,e):(this._dirtyAll=!1,Os(e,i)),e._update=i)));return!this._dirtyAll},mark(t,i,e,n){if(!this.isDirty(i))return i._svg;const s=this._svg,r=i.marktype,o=yn[r],h=!1===i.interactive?"none":null,a="g"===o.tag,l=Ds(i,t,e,"g",s);if("group"!==r&&null!=n&&!n.includes(r))return Sn(l,0),i._svg;l.setAttribute("class",Nn(i));const c=ks(i);for(const t in c)Xs(l,t,c[t]);a||Xs(l,"pointer-events",h),Xs(l,"clip-path",i.clip?xi(this,i,i.group):null);let u=null,_=0;const f=t=>{const i=this.isDirty(t),e=Ds(t,l,u,o.tag,s);i&&(this._update(o,e,t),a&&function(t,i,e,n){i=i.lastChild.previousSibling;let s,r=0;ce(e,(e=>{s=t.mark(i,e,s,n),++r})),Sn(i,1+r)}(this,e,t,n)),u=e,++_};return o.nested?i.items.length&&f(i.items[0]):ce(i,f),Sn(l,_),l},_update(t,i,e){Vs=i,Hs=i.__values__,bs(Bs,e),t.attr(Bs,e,this);const n=js[t.type];n&&n.call(this,t,i,e),Vs&&this.style(Vs,e)},style(t,i){if(null!=i){for(const e in Ss){let n="font"===e?hn(i):i[e];if(n===Hs[e])continue;const s=Ss[e];null==n?t.removeAttribute(s):(h(n)&&(n=a(n,this._defs.gradient,Us())),t.setAttribute(s,n+"")),Hs[e]=n}for(const e in Ns)Gs(t,Ns[e],i[e])}},defs(){const t=this._svg,i=this._defs;let e=i.el,n=0;for(const s in i.gradient)e||(i.el=e=An(t,1,"defs",$s)),n=qs(e,i.gradient[s],n);for(const s in i.clipping)e||(i.el=e=An(t,1,"defs",$s)),n=Is(e,i.clipping[s],n);e&&(0===n?(t.removeChild(e),i.el=null):Sn(e,n))},_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}});let Vs=null,Hs=null;const js={group(t,i,e){const n=Vs=i.childNodes[2];Hs=n.__values__,t.foreground(Bs,e,this),Hs=i.__values__,Vs=i.childNodes[1],t.content(Bs,e,this);const s=Vs=i.childNodes[0];t.background(Bs,e,this);const r=!1===e.mark.interactive?"none":null;if(r!==Hs.events&&(Xs(n,"pointer-events",r),Xs(s,"pointer-events",r),Hs.events=r),e.strokeForeground&&e.stroke){const t=e.fill;Xs(n,"display",null),this.style(s,e),Xs(s,"stroke",null),t&&(e.fill=null),Hs=n.__values__,this.style(n,e),t&&(e.fill=t),Vs=null}else Xs(n,"display","none")},image(t,i,e){!1===e.smooth?(Gs(i,"image-rendering","optimizeSpeed"),Gs(i,"image-rendering","pixelated")):Gs(i,"image-rendering",null)},text(t,e,n){const s=rn(n);let r,o,h,a;i.isArray(s)?(o=s.map((t=>on(n,t))),r=o.join("\n"),r!==Hs.text&&(Sn(e,0),h=e.ownerDocument,a=sn(n),o.forEach(((t,i)=>{const s=Rn(h,"tspan",$s);s.__data__=n,s.textContent=t,i&&(s.setAttribute("x",0),s.setAttribute("dy",a)),e.appendChild(s)})),Hs.text=r)):(o=on(n,s),o!==Hs.text&&(e.textContent=o,Hs.text=o)),Xs(e,"font-family",hn(n)),Xs(e,"font-size",nn(n)+"px"),Xs(e,"font-style",n.fontStyle),Xs(e,"font-variant",n.fontVariant),Xs(e,"font-weight",n.fontWeight)}};function Bs(t,i,e){i!==Hs[t]&&(e?function(t,i,e,n){null!=e?t.setAttributeNS(n,i,e):t.removeAttributeNS(n,i)}(Vs,t,i,e):Xs(Vs,t,i),Hs[t]=i)}function Gs(t,i,e){e!==Hs[i]&&(null==e?t.style.removeProperty(i):t.style.setProperty(i,e+""),Hs[i]=e)}function Ws(t,i){for(const e in i)Xs(t,e,i[e])}function Xs(t,i,e){null!=e?t.setAttribute(i,e):t.removeAttribute(i)}function Us(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function Fs(t){Pn.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}i.inherits(Fs,Pn,{svg(){return this._text},_render(t){const e=Rs();e.open("svg",i.extend({},$e,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",Cs,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){const n=yn[e.marktype],s=n.tag,r=[bs,n.attr];t.open("g",{class:Nn(e),"clip-path":e.clip?xi(this,e,e.group):null},ks(e),{"pointer-events":"g"!==s&&!1===e.interactive?"none":null});const o=o=>{const h=this.href(o);if(h&&t.open("a",h),t.open(s,this.attr(e,o,r,"g"!==s?s:null)),"text"===s){const e=rn(o);if(i.isArray(e)){const i={x:0,dy:sn(o)};for(let n=0;n<e.length;++n)t.open("tspan",n?i:null).text(on(o,e[n])).close()}else t.text(on(o,e))}else if("g"===s){const i=o.strokeForeground,s=o.fill,r=o.stroke;i&&r&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),ce(o,(i=>this.mark(t,i))),t.close(),i&&r?(s&&(o.fill=null),o.stroke=r,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),s&&(o.fill=s)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),h&&t.close()};return n.nested?e.items&&e.items.length&&o(e.items[0]):ce(e,o),t.close()},href(t){const i=t.href;let e;if(i){if(e=this._hrefs&&this._hrefs[i])return e;this.sanitizeURL(i).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[i]=t}))}return null},attr(t,i,e,n){const s={},r=(t,i,e,n)=>{s[n||t]=i};return Array.isArray(e)?e.forEach((t=>t(r,i,this))):e(r,i,this),n&&function(t,i,e,n,s){let r;if(null==i)return t;"bgrect"===n&&!1===e.interactive&&(t["pointer-events"]="none");if("bgfore"===n&&(!1===e.interactive&&(t["pointer-events"]="none"),t.display="none",null!==i.fill))return t;"image"===n&&!1===i.smooth&&(r=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]);"text"===n&&(t["font-family"]=hn(i),t["font-size"]=nn(i)+"px",t["font-style"]=i.fontStyle,t["font-variant"]=i.fontVariant,t["font-weight"]=i.fontWeight);for(const e in Ss){let n=i[e];const r=Ss[e];("transparent"!==n||"fill"!==r&&"stroke"!==r)&&null!=n&&(h(n)&&(n=a(n,s.gradient,"")),t[r]=n)}for(const t in Ns){const e=i[t];null!=e&&(r=r||[],r.push(`${Ns[t]}: ${e};`))}r&&(t.style=r.join(" "))}(s,i,t,n,this._defs),s},defs(t){const i=this._defs.gradient,e=this._defs.clipping;if(0!==Object.keys(i).length+Object.keys(e).length){t.open("defs");for(const e in i){const n=i[e],s=n.stops;"radial"===n.gradient?(t.open("pattern",{id:o+e,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+e+")"}).close(),t.close(),t.open("radialGradient",{id:e,fx:n.x1,fy:n.y1,fr:n.r1,cx:n.x2,cy:n.y2,r:n.r2})):t.open("linearGradient",{id:e,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2});for(let i=0;i<s.length;++i)t.open("stop",{offset:s[i].offset,"stop-color":s[i].color}).close();t.close()}for(const i in e){const n=e[i];t.open("clipPath",{id:i}),n.path?t.open("path",{d:n.path}).close():t.open("rect",{x:0,y:0,width:n.width,height:n.height}).close(),t.close()}t.close()}}});const Ys={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function Js(t){Pn.call(this,t),this._svgRenderer=new Ps(t),this._canvasRenderer=new hs(t)}const Zs=Pn.prototype;function Qs(t,i){is.call(this,t,i)}i.inherits(Js,Pn,{initialize(t,i,e,n,s){this._root_el=An(t,0,"div");const r=An(this._root_el,0,"div"),o=An(this._root_el,1,"div");return this._root_el.style.position="relative",Ys.debug||(r.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%"),this._svgEl=Ys.svgOnTop?o:r,this._canvasEl=Ys.svgOnTop?r:o,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,i,e,n,s),this._svgRenderer.initialize(this._svgEl,i,e,n,s),Zs.initialize.call(this,t,i,e,n,s)},dirty(t){return Ys.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this},_render(t,i){const e=(i??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter((t=>!Ys.svgMarkTypes.includes(t)));this._svgRenderer.render(t,Ys.svgMarkTypes),this._canvasRenderer.render(t,e)},resize(t,i,e,n){return Zs.resize.call(this,t,i,e,n),this._svgRenderer.resize(t,i,e,n),this._canvasRenderer.resize(t,i,e,n),this},background(t){return Ys.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}),i.inherits(Qs,is,{initialize(t,i,e){const n=An(An(t,0,"div"),Ys.svgOnTop?0:1,"div");return is.prototype.initialize.call(this,n,i,e)}});const Ks="canvas",tr="hybrid",ir="none",er={Canvas:Ks,PNG:"png",SVG:"svg",Hybrid:tr,None:ir},nr={};function sr(t,i,e,n){if(function(t,i,e){return t.bounds&&i.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!e||e(t)))}(t,i,e)){const s=t.items,r=t.marktype,o=s.length;let h=0;if("group"===r)for(;h<o;++h)rr(s[h],i,e,n);else for(const t=yn[r].isect;h<o;++h){const e=s[h];or(e,i,t)&&n.push(e)}}return n}function rr(t,i,e,n){e&&e(t.mark)&&or(t,i,yn.group.isect)&&n.push(t);const s=t.items,r=s&&s.length;if(r){const o=t.x||0,h=t.y||0;i.translate(-o,-h);for(let t=0;t<r;++t)sr(s[t],i,e,n);i.translate(o,h)}return n}function or(t,i,e){const n=t.bounds;return i.encloses(n)||i.intersects(n)&&e(t,i)}nr[Ks]=nr.png={renderer:hs,headless:hs,handler:is},nr.svg={renderer:Ps,headless:Fs,handler:ls},nr[tr]={renderer:Js,headless:Js,handler:Qs},nr[ir]={};const hr=new gi;const ar=1e-9;function lr(t,e,n){return t===e||("path"===n?cr(t,e):t instanceof Date&&e instanceof Date?+t==+e:i.isNumber(t)&&i.isNumber(e)?Math.abs(t-e)<=ar:t&&e&&(i.isObject(t)||i.isObject(e))?function(t,i){var e,n,s=Object.keys(t),r=Object.keys(i);if(s.length!==r.length)return!1;for(s.sort(),r.sort(),n=s.length-1;n>=0;n--)if(s[n]!=r[n])return!1;for(n=s.length-1;n>=0;n--)if(!lr(t[e=s[n]],i[e],e))return!1;return typeof t==typeof i}(t,e):t==e)}function cr(t,i){return lr(Nt(t),Nt(i))}t.Bounds=gi,t.CanvasHandler=is,t.CanvasRenderer=hs,t.Gradient=function(t,i){var e,n=[];return e={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:i?i[0]:1,y2:i?i[1]:0,stops:n,stop:function(t,i){return n.push({offset:t,color:i}),e}}},t.GroupItem=mi,t.Handler=En,t.HybridHandler=Qs,t.HybridRenderer=Js,t.Item=vi,t.Marks=yn,t.RenderType=er,t.Renderer=Pn,t.ResourceLoader=bi,t.SVGHandler=ls,t.SVGRenderer=Ps,t.SVGStringRenderer=Fs,t.Scenegraph=Tn,t.boundClip=function(t){const e=t.clip;if(i.isFunction(e))e(ji(hr.clear()));else{if(!e)return;hr.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(hr)},t.boundContext=ji,t.boundItem=xn,t.boundMark=vn,t.boundStroke=Ti,t.domChild=An,t.domClear=Sn,t.domCreate=Rn,t.domFind=zn,t.font=an,t.fontFamily=hn,t.fontSize=nn,t.intersect=function(t,e,n){const s=[],r=(new gi).union(e),o=t.marktype;return o?sr(t,r,n,s):"group"===o?rr(t,r,n,s):i.error("Intersect scene must be mark node or group item.")},t.intersectBoxLine=Ki,t.intersectPath=Yi,t.intersectPoint=Ji,t.intersectRule=Qi,t.lineHeight=sn,t.markup=Rs,t.multiLineOffset=function(t){const e=rn(t);return(i.isArray(e)?e.length-1:0)*sn(t)},t.path=S,t.pathCurves=Tt,t.pathEqual=cr,t.pathParse=Nt,t.pathRectangle=ti,t.pathRender=Ht,t.pathSymbols=Wt,t.pathTrail=ii,t.point=Cn,t.renderModule=function(t,i){return t=String(t||"").toLowerCase(),arguments.length>1?(nr[t]=i,this):nr[t]},t.resetSVGClipId=yi,t.resetSVGDefIds=function(){yi(),r=0},t.sceneEqual=lr,t.sceneFromJSON=kn,t.scenePickVisit=ue,t.sceneToJSON=bn,t.sceneVisit=ce,t.sceneZOrder=le,t.serializeXML=zs,t.setHybridRendererOptions=function(t){Ys.svgMarkTypes=t.svgMarkTypes??["text"],Ys.svgOnTop=t.svgOnTop??!0,Ys.debug=t.debug??!1},t.textMetrics=Je}));
//# sourceMappingURL=vega-scenegraph.min.js.map
