{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n/*-----------------------------------------------------------------------------\n| Copyright (c) 2014-2017, PhosphorJS Contributors\n|\n| Distributed under the terms of the BSD 3-Clause License.\n|\n| The full license is in the file LICENSE, distributed with this software.\n|----------------------------------------------------------------------------*/\n/**\n * @packageDocumentation\n * @module disposable\n */\nimport { ISignal, Signal } from '@lumino/signaling';\n\n/**\n * An object which implements the disposable pattern.\n */\nexport interface IDisposable {\n  /**\n   * Test whether the object has been disposed.\n   *\n   * #### Notes\n   * This property is always safe to access.\n   */\n  readonly isDisposed: boolean;\n\n  /**\n   * Dispose of the resources held by the object.\n   *\n   * #### Notes\n   * If the object's `dispose` method is called more than once, all\n   * calls made after the first will be a no-op.\n   *\n   * #### Undefined Behavior\n   * It is undefined behavior to use any functionality of the object\n   * after it has been disposed unless otherwise explicitly noted.\n   */\n  dispose(): void;\n}\n\n/**\n * A disposable object with an observable `disposed` signal.\n */\nexport interface IObservableDisposable extends IDisposable {\n  /**\n   * A signal emitted when the object is disposed.\n   */\n  readonly disposed: ISignal<this, void>;\n}\n\n/**\n * A disposable object which delegates to a callback function.\n */\nexport class DisposableDelegate implements IDisposable {\n  /**\n   * Construct a new disposable delegate.\n   *\n   * @param fn - The callback function to invoke on dispose.\n   */\n  constructor(fn: () => void) {\n    this._fn = fn;\n  }\n\n  /**\n   * Test whether the delegate has been disposed.\n   */\n  get isDisposed(): boolean {\n    return !this._fn;\n  }\n\n  /**\n   * Dispose of the delegate and invoke the callback function.\n   */\n  dispose(): void {\n    if (!this._fn) {\n      return;\n    }\n    let fn = this._fn;\n    this._fn = null;\n    fn();\n  }\n\n  private _fn: (() => void) | null;\n}\n\n/**\n * An observable disposable object which delegates to a callback function.\n */\nexport class ObservableDisposableDelegate\n  extends DisposableDelegate\n  implements IObservableDisposable\n{\n  /**\n   * A signal emitted when the delegate is disposed.\n   */\n  get disposed(): ISignal<this, void> {\n    return this._disposed;\n  }\n\n  /**\n   * Dispose of the delegate and invoke the callback function.\n   */\n  dispose(): void {\n    if (this.isDisposed) {\n      return;\n    }\n    super.dispose();\n    this._disposed.emit(undefined);\n    Signal.clearData(this);\n  }\n\n  private _disposed = new Signal<this, void>(this);\n}\n\n/**\n * An object which manages a collection of disposable items.\n */\nexport class DisposableSet implements IDisposable {\n  /**\n   * Test whether the set has been disposed.\n   */\n  get isDisposed(): boolean {\n    return this._isDisposed;\n  }\n\n  /**\n   * Dispose of the set and the items it contains.\n   *\n   * #### Notes\n   * Items are disposed in the order they are added to the set.\n   */\n  dispose(): void {\n    if (this._isDisposed) {\n      return;\n    }\n    this._isDisposed = true;\n    this._items.forEach(item => {\n      item.dispose();\n    });\n    this._items.clear();\n  }\n\n  /**\n   * Test whether the set contains a specific item.\n   *\n   * @param item - The item of interest.\n   *\n   * @returns `true` if the set contains the item, `false` otherwise.\n   */\n  contains(item: IDisposable): boolean {\n    return this._items.has(item);\n  }\n\n  /**\n   * Add a disposable item to the set.\n   *\n   * @param item - The item to add to the set.\n   *\n   * #### Notes\n   * If the item is already contained in the set, this is a no-op.\n   */\n  add(item: IDisposable): void {\n    this._items.add(item);\n  }\n\n  /**\n   * Remove a disposable item from the set.\n   *\n   * @param item - The item to remove from the set.\n   *\n   * #### Notes\n   * If the item is not contained in the set, this is a no-op.\n   */\n  remove(item: IDisposable): void {\n    this._items.delete(item);\n  }\n\n  /**\n   * Remove all items from the set.\n   */\n  clear(): void {\n    this._items.clear();\n  }\n\n  private _isDisposed = false;\n  private _items = new Set<IDisposable>();\n}\n\n/**\n * The namespace for the `DisposableSet` class statics.\n */\nexport namespace DisposableSet {\n  /**\n   * Create a disposable set from an iterable of items.\n   *\n   * @param items - The iterable object of interest.\n   *\n   * @returns A new disposable initialized with the given items.\n   */\n  export function from(items: Iterable<IDisposable>): DisposableSet {\n    let set = new DisposableSet();\n    for (const item of items) {\n      set.add(item);\n    }\n    return set;\n  }\n}\n\n/**\n * An observable object which manages a collection of disposable items.\n */\nexport class ObservableDisposableSet\n  extends DisposableSet\n  implements IObservableDisposable\n{\n  /**\n   * A signal emitted when the set is disposed.\n   */\n  get disposed(): ISignal<this, void> {\n    return this._disposed;\n  }\n\n  /**\n   * Dispose of the set and the items it contains.\n   *\n   * #### Notes\n   * Items are disposed in the order they are added to the set.\n   */\n  dispose(): void {\n    if (this.isDisposed) {\n      return;\n    }\n    super.dispose();\n    this._disposed.emit(undefined);\n    Signal.clearData(this);\n  }\n\n  private _disposed = new Signal<this, void>(this);\n}\n\n/**\n * The namespace for the `ObservableDisposableSet` class statics.\n */\nexport namespace ObservableDisposableSet {\n  /**\n   * Create an observable disposable set from an iterable of items.\n   *\n   * @param items - The iterable object of interest.\n   *\n   * @returns A new disposable initialized with the given items.\n   */\n  export function from(items: Iterable<IDisposable>): ObservableDisposableSet {\n    let set = new ObservableDisposableSet();\n    for (const item of items) {\n      set.add(item);\n    }\n    return set;\n  }\n}\n"],"names":["Signal"],"mappings":"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"}